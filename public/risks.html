<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Risk Management ‚Äî SmartCool Pro Intranet"
    />
    <meta name="theme-color" content="#3b82f6" />
    <title>Risks | SmartCool Pro</title>
    <link rel="icon" href="/favicon.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* Styles from ddd/risks.html */
      .sheet-wrapper {
        overflow-x: auto;
        background: white;
        border: 1px solid #e0e0e0;
        margin-top: 20px;
      }
      .google-sheet-style {
        border-collapse: collapse;
        width: 100%;
        font-family: arial, sans-serif;
        font-size: 13px;
      }
      .google-sheet-style th {
        background-color: #f8f9fa;
        border: 1px solid #e0e0e0;
        padding: 8px;
        text-align: left;
        color: #5f6368;
        font-weight: bold;
        position: sticky;
        top: 0;
      }
      .google-sheet-style td {
        border: 1px solid #e0e0e0;
        padding: 6px 8px;
        color: #000;
      }
      .google-sheet-style tr:nth-child(even) {
        background-color: #ffffff;
      }
      .google-sheet-style .row-num {
        background-color: #f8f9fa;
        text-align: center;
        color: #5f6368;
        font-weight: bold;
        width: 30px;
      }
      .download-btn {
        display: inline-block;
        background: #27ae60;
        color: white;
        padding: 10px 20px;
        text-decoration: none;
        border-radius: 5px;
        margin-bottom: 10px;
        font-weight: bold;
      }
      .download-btn:hover {
        background: #219150;
      }
    </style>
  </head>
  <body>
    <script src="js/sidebar.js"></script>
    <script>
      window.si =
        window.si ||
        function () {
          (window.siq = window.siq || []).push(arguments);
        };
    </script>
    <script defer src="/_vercel/speed-insights/script.js"></script>
    <main class="main-content">
      <header>
        <h1>
          <i
            class="fas fa-shield-alt"
            style="color: var(--accent); margin-right: 10px"
          ></i
          >Risk Management
        </h1>
        <p>
          Identification, assessment, and mitigation of critical project risks.
        </p>
      </header>

      <div
        class="card-grid"
        style="grid-template-columns: 1fr"
        id="risks-container"
      >
        <!-- Risks injected by JS -->
      </div>

      <h2 style="margin-top: 40px; margin-bottom: 20px;">Matrice des Risques Compl√®te</h2>
      <a
        href="spreadsheets/SmartCool_Risques_Detailles.csv"
        class="download-btn"
        >üì• T√©l√©charger le CSV (Compatible Excel/Sheets)</a
      >
      <div class="sheet-container">
        <table class="google-sheet-style">
          <thead>
            <tr>
              <th>#</th>
              <th>REF</th>
              <th>DESCRIPTION DU RISQUE</th>
              <th>CATEGORIE</th>
              <th>PROBABILITE (1-5)</th>
              <th>IMPACT (1-5)</th>
              <th>CRITICITE</th>
              <th>DECLENCHEUR</th>
              <th>PLAN D'ATTENUATION (MITIGATION)</th>
              <th>RESPONSABLE</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="row-num">1</td>
              <td>R01</td>
              <td>Rupture de stock microcontr√¥leur STM32</td>
              <td>Supply Chain</td>
              <td>4</td>
              <td>5</td>
              <td>20</td>
              <td>D√©lai fournisseur > 12 sem</td>
              <td>
                Design 'Double Empreinte' sur le PCB pour accepter une puce
                GigaDevice (clone) en backup.
              </td>
              <td>Hardware Lead</td>
            </tr>
            <tr>
              <td class="row-num">2</td>
              <td>R02</td>
              <td>Condensation sur la lentille cam√©ra</td>
              <td>Technique</td>
              <td>3</td>
              <td>5</td>
              <td>15</td>
              <td>Flou sur les images</td>
              <td>
                Int√©gration d'un fil r√©sistif chauffant autour de la lentille +
                Algorithme de d√©sembuage.
              </td>
              <td>Hardware Lead</td>
            </tr>
            <tr>
              <td class="row-num">3</td>
              <td>R03</td>
              <td>Co√ªt BOM d√©passe la cible (170‚Ç¨)</td>
              <td>Financier</td>
              <td>3</td>
              <td>4</td>
              <td>12</td>
              <td>Inflation composants</td>
              <td>
                N√©gociation de prix sur volume annuel (10k unit√©s) ou
                suppression de l'√©cran tactile (remplac√© par App mobile).
              </td>
              <td>Acheteur</td>
            </tr>
            <tr>
              <td class="row-num">4</td>
              <td>R04</td>
              <td>Faux positifs IA (Confusion Pomme/Tomate)</td>
              <td>Qualit√©</td>
              <td>4</td>
              <td>3</td>
              <td>12</td>
              <td>Plaintes utilisateurs b√™ta</td>
              <td>
                Mise en place d'un syst√®me 'Human-in-the-loop' : l'utilisateur
                corrige l'IA dans l'app, am√©liorant le mod√®le.
              </td>
              <td>Data Scientist</td>
            </tr>
            <tr>
              <td class="row-num">5</td>
              <td>R05</td>
              <td>√âchec Certification EMC (Rayonnement)</td>
              <td>L√©gal</td>
              <td>2</td>
              <td>5</td>
              <td>10</td>
              <td>Refus labo certification</td>
              <td>
                Ajout de cages de Faraday sur le PCB d√®s la version Alpha +
                perles de ferrite sur les c√¢bles.
              </td>
              <td>RF Engineer</td>
            </tr>
            <tr>
              <td class="row-num">6</td>
              <td>R06</td>
              <td>Latence Cloud trop √©lev√©e (>3s)</td>
              <td>UX</td>
              <td>2</td>
              <td>3</td>
              <td>6</td>
              <td>Mauvaise connexion Wi-Fi</td>
              <td>
                Architecture 'Edge First' : tout le traitement critique se fait
                en local sur le Raspberry Pi, pas de d√©pendance cloud.
              </td>
              <td>Software Lead</td>
            </tr>
          </tbody>
        </table>
      </div>
    </main>
    <script>
      fetch("/api/risks")
        .then((res) => res.json())
        .then((risks) => {
          const container = document.getElementById("risks-container");
          container.innerHTML = risks
            .map(
              (risk, index) => `
                    <div class="card risk-card" id="risk-${risk.id}">
                        <div style="display: flex; gap: 20px;">
                            <div style="font-size: 2rem; color: ${
                              risk.color
                            }; padding-top: 5px;">
                                <i class="fas ${risk.icon}"></i>
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <h3 style="color: ${risk.color};">${
                index + 1
              }. ${risk.title}</h3>
                                    <div style="text-align: right;">
                                        <span class="status-badge status-risk">${
                                          risk.prob
                                        } Probability</span>
                                        <span class="status-badge status-risk">${
                                          risk.impact
                                        } Impact</span>
                                    </div>
                                </div>
                                <p style="margin-top: 8px;"><strong>Context:</strong> ${
                                  risk.context
                                }</p>
                                <div style="margin-top: 16px; background: #fef2f2; padding: 16px; border-radius: 8px;">
                                    <strong><i class="fas fa-tools"></i> Mitigation Strategy:</strong>
                                    <p style="margin-top: 8px; color: #7f1d1d;">${
                                      risk.mitigation
                                    }</p>
                                </div>
                                <button onclick="resolveRisk('risk-${
                                  risk.id
                                }')" style="margin-top: 15px; padding: 8px 16px; background: white; border: 1px solid #cbd5e1; border-radius: 6px; cursor: pointer; font-size: 0.85rem;">
                                    <i class="fas fa-check"></i> Mark as Resolved
                                </button>
                            </div>
                        </div>
                    </div>
                `
            )
            .join("");
        });

      function resolveRisk(id) {
        const card = document.getElementById(id);
        card.style.opacity = "0.6";
        card.style.filter = "grayscale(100%)";
        const btn = card.querySelector("button");
        btn.innerHTML = '<i class="fas fa-check-double"></i> Resolved';
        btn.disabled = true;
        btn.style.background = "#dcfce7";
        btn.style.color = "#166534";
        btn.style.borderColor = "transparent";
      }
    </script>
  </body>
</html>
